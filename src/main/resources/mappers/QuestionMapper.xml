<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.quiz.mapper.QuestionMapper">
    <resultMap id="QuestionWithCategoryMap" type="com.example.quiz.model.Question">
        <id property="id" column="id" />
        <result property="text" column="text" />
        <result property="optionA" column="option_a" />
        <result property="optionB" column="option_b" />
        <result property="optionC" column="option_c" />
        <result property="optionD" column="option_d" />
        <result property="correctAnswer" column="correct_answer" />
        <result property="categoryId" column="category_id" />
        <result property="categoryName" column="category_name" />
    </resultMap>

    <!-- 全件（カテゴリなし: Phase1互換） -->
    <select id="findAll" resultType="com.example.quiz.model.Question">
        SELECT id, text, option_a AS optionA, option_b AS optionB, option_c AS optionC, option_d AS optionD, correct_answer AS correctAnswer
        FROM questions ORDER BY id
    </select>

    <!-- カテゴリIDで取得 -->
    <select id="findByCategoryId" parameterType="Integer" resultType="com.example.quiz.model.Question">
        SELECT id, category_id AS categoryId, text, option_a AS optionA, option_b AS optionB, option_c AS optionC, option_d AS optionD, correct_answer AS correctAnswer
        FROM questions WHERE category_id = #{categoryId} ORDER BY id
    </select>

    <!-- JOINでカテゴリ名も取得 -->
    <select id="findAllWithCategory" resultMap="QuestionWithCategoryMap">
        SELECT q.id, q.category_id, q.text,
               q.option_a, q.option_b, q.option_c, q.option_d, q.correct_answer,
               c.name AS category_name
        FROM questions q
        LEFT JOIN categories c ON q.category_id = c.id
        ORDER BY q.id
    </select>
</mapper>
